const themes=[{id:"default",color:"#0f172a",text:"#ffffff"},{id:"sunset",color:"#431407",text:"#ffffff"},{id:"forest",color:"#022c22",text:"#ffffff"},{id:"berry",color:"#500724",text:"#ffffff"},{id:"abyss",color:"#000000",text:"#ffffff"},{id:"cloud",color:"#f0f9ff",text:"#0c4a6e"},{id:"peach",color:"#fff7ed",text:"#9a3412"},{id:"mint",color:"#ecfdf5",text:"#065f46"},{id:"lilac",color:"#faf5ff",text:"#6b21a8"},{id:"sand",color:"#fffbeb",text:"#92400e"},{id:"navy",color:"#0f172a",text:"#ffffff"},{id:"crimson",color:"#450a0a",text:"#ffffff"},{id:"charcoal",color:"#18181b",text:"#ffffff"},{id:"violet",color:"#2e1065",text:"#ffffff"},{id:"emerald",color:"#064e3b",text:"#ffffff"},{id:"rose",color:"#fff1f2",text:"#9f1239"},{id:"sky",color:"#f0f9ff",text:"#075985"},{id:"lemon",color:"#fefce8",text:"#854d0e"},{id:"ivory",color:"#fafaf9",text:"#57534e"},{id:"ice",color:"#ecfeff",text:"#155e75"}],supportedLangs=[{id:"it",label:"Italiano",flag:"it"},{id:"en",label:"English",flag:"gb"},{id:"es",label:"Español",flag:"es"},{id:"fr",label:"Français",flag:"fr"},{id:"de",label:"Deutsch",flag:"de"},{id:"pt",label:"Português",flag:"pt"},{id:"ru",label:"Русский",flag:"ru"},{id:"zh",label:"中文",flag:"cn"},{id:"ja",label:"日本語",flag:"jp"},{id:"ko",label:"한국어",flag:"kr"},{id:"ar",label:"العربية",flag:"sa"},{id:"hi",label:"हिन्दी",flag:"in"},{id:"tr",label:"Türkçe",flag:"tr"},{id:"nl",label:"Nederlands",flag:"nl"},{id:"pl",label:"Polski",flag:"pl"},{id:"sv",label:"Svenska",flag:"se"},{id:"vi",label:"Tiếng Việt",flag:"vn"},{id:"th",label:"ไทย",flag:"th"},{id:"el",label:"Ελληνικά",flag:"gr"},{id:"uk",label:"Українська",flag:"ua"}];let translations={},currentLang=localStorage.getItem("countdown_lang");if(!currentLang){const e=(navigator.language||"it").split("-")[0];currentLang=supportedLangs.some(t=>t.id===e)?e:"it"}let isTickSoundEnabled="false"!==localStorage.getItem("countdown_tick_sound"),isAlarmSoundEnabled="false"!==localStorage.getItem("countdown_alarm_sound"),tickVolume=parseFloat(localStorage.getItem("countdown_tick_volume")||"0.1"),alarmVolume=parseFloat(localStorage.getItem("countdown_alarm_volume")||"0.1");function t(e){return translations[currentLang]&&translations[currentLang][e]||e}async function loadTranslations(){await applyLanguage(currentLang)}async function applyLanguage(e){if(!translations[e])try{const t=await fetch(`../assets/languages/${e}.json`);t.ok&&(translations[e]=await t.json())}catch(e){console.error("Translation load error:",e)}translations[e]&&(translations[e].modal_sound_title||(translations[e].modal_sound_title="it"===e?"Impostazioni Suono":"Sound Settings"),translations[e].tick_sound_label||(translations[e].tick_sound_label="it"===e?"Suono Ticchettio":"Tick Sound"),translations[e].alarm_sound_label||(translations[e].alarm_sound_label="it"===e?"Suono Allarme":"Alarm Sound"),translations[e].widget_generator_title||(translations[e].widget_generator_title="Widget Generator"),translations[e].generate_widget_btn||(translations[e].generate_widget_btn="it"===e?"Genera Widget":"Generate Widget"),translations[e].copy_code_btn||(translations[e].copy_code_btn="it"===e?"Copia Codice":"Copy Code"),translations[e].copied_msg||(translations[e].copied_msg="it"===e?"Copiato!":"Copied!"),translations[e].timer_title_placeholder||(translations[e].timer_title_placeholder="it"===e?"Titolo del Timer (opzionale)":"Timer Title (optional)"),translations[e].hours_label||(translations[e].hours_label="it"===e?"ORE":"HOURS"),translations[e].minutes_label||(translations[e].minutes_label="it"===e?"MINUTI":"MINUTES")),currentLang=e,document.documentElement.setAttribute("lang",e),document.documentElement.setAttribute("data-lang",e),document.querySelectorAll("[data-i18n]").forEach(e=>{const n=e.getAttribute("data-i18n");n&&(e.textContent=t(n))}),document.querySelectorAll("[data-i18n-placeholder]").forEach(e=>{e.placeholder=t(e.getAttribute("data-i18n-placeholder"))})}function setupThemeControls(){const e=document.getElementById("theme-modal"),n=document.getElementById("theme-open-btn"),a=e.querySelector(".close-modal"),o=document.getElementById("theme-grid"),l=document.getElementById("theme-search"),s=localStorage.getItem("countdown_theme");if(s&&"default"!==s&&document.body.setAttribute("data-theme",s),l&&l.addEventListener("input",e=>{const t=e.target.value.toLowerCase();o.querySelectorAll(".theme-option").forEach(e=>{const n=e.querySelector("span").textContent.toLowerCase();e.style.display=n.includes(t)?"flex":"none"})}),themes.forEach(n=>{const a=document.createElement("div");a.className="theme-option",a.tabIndex=0,a.setAttribute("role","button");const l=document.createElement("div");l.className="theme-preview",l.style.background=n.color;const s=document.createElement("span");s.setAttribute("data-i18n","theme_"+n.id),s.textContent=t("theme_"+n.id),a.appendChild(l),a.appendChild(s),a.addEventListener("click",()=>{"default"===n.id?document.body.removeAttribute("data-theme"):document.body.setAttribute("data-theme",n.id),o.querySelectorAll(".theme-option").forEach(e=>e.classList.remove("selected")),a.classList.add("selected"),e.classList.remove("open")}),o.appendChild(a)}),s){const e=o.querySelector(`.theme-option:nth-child(${themes.findIndex(e=>e.id===s)+1})`);e&&e.classList.add("selected")}n&&n.addEventListener("click",()=>e.classList.add("open")),a&&a.addEventListener("click",()=>e.classList.remove("open")),e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")})}function setupLanguageControls(){const e=document.getElementById("lang-modal"),t=document.getElementById("lang-open-btn"),n=e?e.querySelector(".close-modal"):null,a=document.getElementById("lang-list"),o=document.getElementById("lang-search");supportedLangs.forEach(t=>{const n=document.createElement("div");n.className="lang-option",n.dataset.lang=t.id;const o=document.createElement("span");o.textContent=t.label,n.appendChild(o),n.addEventListener("click",async()=>{await applyLanguage(t.id),a.querySelectorAll(".lang-option").forEach(e=>e.classList.remove("selected")),n.classList.add("selected"),e.classList.remove("open")}),a.appendChild(n)}),o&&o.addEventListener("input",e=>{const t=e.target.value.toLowerCase();Array.from(a.children).forEach(e=>{const n=e.querySelector("span").textContent.toLowerCase();e.style.display=n.includes(t)?"flex":"none"})});const l=a.querySelector(`.lang-option[data-lang="${currentLang}"]`);l&&l.classList.add("selected"),t&&t.addEventListener("click",()=>e.classList.add("open")),n&&n.addEventListener("click",()=>e.classList.remove("open")),e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")})}function setupSoundControls(){const e=document.getElementById("sound-modal"),t=document.getElementById("sound-toggle-btn"),n=e?e.querySelector(".close-modal"):null,a=document.getElementById("tick-sound-toggle"),o=document.getElementById("alarm-sound-toggle"),l=document.getElementById("tick-volume"),s=document.getElementById("alarm-volume"),r=document.getElementById("tick-volume-container"),i=document.getElementById("alarm-volume-container");function d(){r&&(r.style.display=isTickSoundEnabled?"block":"none"),i&&(i.style.display=isAlarmSoundEnabled?"block":"none")}a&&(a.checked=isTickSoundEnabled,a.addEventListener("change",e=>{isTickSoundEnabled=e.target.checked,d()})),o&&(o.checked=isAlarmSoundEnabled,o.addEventListener("change",e=>{isAlarmSoundEnabled=e.target.checked,d()})),l&&(l.value=tickVolume,l.addEventListener("input",e=>{tickVolume=parseFloat(e.target.value)})),s&&(s.value=alarmVolume,s.addEventListener("input",e=>{alarmVolume=parseFloat(e.target.value)})),d(),t&&t.addEventListener("click",()=>e.classList.add("open")),n&&n.addEventListener("click",()=>e.classList.remove("open")),e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")})}function setupSettingsModal(){const e=document.getElementById("settings-modal"),t=document.getElementById("mobile-settings-btn"),n=e?e.querySelector(".close-modal"):null;if(!e||!t)return;t.addEventListener("click",()=>e.classList.add("open")),n&&n.addEventListener("click",()=>e.classList.remove("open")),e.addEventListener("click",t=>{t.target===e&&e.classList.remove("open")});const a={"settings-theme-btn":"theme-modal","settings-lang-btn":"lang-modal","settings-sound-btn":"sound-modal"};Object.keys(a).forEach(t=>{const n=document.getElementById(t);n&&n.addEventListener("click",()=>{e.classList.remove("open");const n=document.getElementById(a[t]);if(n){n.classList.add("from-settings"),n.classList.add("open");const e=n.querySelector(".search-input");e&&setTimeout(()=>e.focus(),50)}})}),document.querySelectorAll(".back-modal").forEach(t=>{t.addEventListener("click",n=>{n.stopPropagation();const a=t.closest(".modal");a&&(a.classList.remove("open"),a.classList.remove("from-settings")),e.classList.add("open")})});["theme-open-btn","lang-open-btn","sound-toggle-btn"].forEach(e=>{const t=document.getElementById(e),n=e.replace("-open-btn","-modal").replace("-toggle-btn","-modal");t&&t.addEventListener("click",()=>{const e=document.getElementById(n);e&&e.classList.remove("from-settings")})})}function setupAnimationSwitcher(){const e=document.getElementById("animation-toggle"),t="false"!==localStorage.getItem("countdown_animation");e&&(e.checked=t,applyAnimationState(t),e.addEventListener("change",e=>{applyAnimationState(e.target.checked)}))}function applyAnimationState(e){document.body.classList.toggle("no-animations",!e)}function startBlobAnimation(){const e=document.querySelectorAll(".blob");function t(){document.body.classList.contains("no-animations")||(e.forEach(e=>{const t=Math.random()*(window.innerWidth-e.clientWidth),n=Math.random()*(window.innerHeight-e.clientHeight);e.style.transform=`translate(${t}px, ${n}px)`}),setTimeout(t,2e4))}t();const n=document.getElementById("animation-toggle");n&&n.addEventListener("change",e=>{e.target.checked&&t()})}function showNotification(e){const t=document.querySelector(".custom-notification");t&&t.remove();const n=document.createElement("div");n.className="custom-notification",n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slide-out-left 0.5s forwards",n.addEventListener("animationend",()=>{n.parentNode&&n.remove()})},3e3)}document.querySelectorAll('.range-wrapper input[type="range"]').forEach(e=>{const t=()=>{const t=(e.value-e.min)/(e.max-e.min)*100;e.style.setProperty("--range-progress",`${t}%`)};e.addEventListener("input",t),t()}),document.getElementById("generate-btn").addEventListener("click",()=>{const e=document.getElementById("hours").value,n=document.getElementById("minutes").value;if(0===(parseInt(e)||0)&&0===(parseInt(n)||0))return void showNotification(t("notif_min_time"));const a=document.getElementById("timer-title-input"),o=a?a.value:"",l=document.body.getAttribute("data-theme")||"default",s=new URL("template/wt.html",window.location.href).href.split("?")[0],r=new URL(s);r.searchParams.set("widget","true"),r.searchParams.set("theme",l),r.searchParams.set("lang",currentLang),e>0&&r.searchParams.set("h",e),n>0&&r.searchParams.set("m",n),o&&r.searchParams.set("title",o),r.searchParams.set("tick",isTickSoundEnabled),r.searchParams.set("alarm",isAlarmSoundEnabled),r.searchParams.set("tickVol",tickVolume),r.searchParams.set("alarmVol",alarmVolume);const i=document.getElementById("widget-anim-toggle");i&&r.searchParams.set("anim",i.checked);const d=document.getElementById("transparent-bg-toggle");d&&d.checked&&r.searchParams.set("bg","transparent");const c=document.getElementById("hide-btn-toggle");c&&c.checked&&r.searchParams.set("hideBtn","true");const m=document.getElementById("auto-restart-toggle");m&&m.checked&&r.searchParams.set("autoRestart","true");const u=`<iframe src="${r.toString()}" width="100%" height="600" frameborder="0" allow="autoplay; fullscreen"></iframe>`,g=document.getElementById("widget-output"),f=document.getElementById("widget-code");f.value=u,g.classList.remove("hidden"),requestAnimationFrame(()=>{autoResizeTextarea(f),f.scrollTop=0}),g.scrollIntoView({behavior:"smooth"})}),document.getElementById("copy-btn").addEventListener("click",()=>{document.getElementById("widget-code").select(),document.execCommand("copy");const e=document.getElementById("copy-btn"),n=e.innerHTML;e.innerHTML=`<i class="fa-solid fa-check"></i> ${t("copied_msg")}`,setTimeout(()=>e.innerHTML=n,2e3)}),document.addEventListener("DOMContentLoaded",()=>{const e=loadTranslations();setupThemeControls(),setupLanguageControls(),setupSoundControls(),setupSettingsModal(),setupAnimationSwitcher(),startBlobAnimation(),[document.getElementById("hours"),document.getElementById("minutes")].forEach(e=>{e&&e.addEventListener("input",()=>{const t=e.max.length;e.value.length>t&&(e.value=e.value.slice(0,t));const n=parseInt(e.value),a=parseInt(e.max);!isNaN(n)&&!isNaN(a)&&n>a&&(e.value=a)})});const t=document.getElementById("loading-screen"),n=document.querySelector(".loader-bar"),a=document.querySelector(".loader-percentage"),o=document.querySelector(".loader-text");if(t&&n){let l=0;const s={it:["Caricamento risorse...","Preparazione font...","Configurazione temi...","Avvio sistema...","Pronto!"],en:["Loading resources...","Preparing fonts...","Configuring themes...","Starting system...","Ready!"],es:["Cargando recursos...","Preparando fuentes...","Configurando temas...","Iniciando sistema...","¡Listo!"],fr:["Chargement des ressources...","Préparation des polices...","Configuration des thèmes...","Démarrage du système...","Prêt!"],de:["Ressourcen laden...","Schriftarten vorbereiten...","Themen konfigurieren...","System starten...","Bereit!"],pt:["Carregando recursos...","Preparando fontes...","Configurando temas...","Iniciando sistema...","Pronto!"],ru:["Загрузка ресурсов...","Подготовка шрифтов...","Настройка тем...","Запуск системы...","Готово!"],zh:["加载资源...","准备字体...","配置主题...","启动系统...","准备就绪！"],ja:["リソースを読み込んでいます...","フォントを準備中...","テーマを設定中...","システムを起動中...","準備完了！"],ko:["리소스를 로드 중...","글꼴 준비 중...","테마 구성 중...","시스템 시작 중...","준비 완료!"],ar:["جارٍ تحميل الموارد...","جارٍ إعداد الخطوط...","جارٍ تكوين السمات...","جارٍ بدء النظام...","جاهز!"],hi:["संसाधन लोड हो रहे हैं...","फ़ॉन्ट तैयार किए जा रहे हैं...","थीम कॉन्फ़िगर की जा रही हैं...","सिस्टम शुरू हो रहा है...","तैयार!"],tr:["Kaynaklar yükleniyor...","Yazı tipleri hazırlanıyor...","Temalar yapılandırılıyor...","Sistem başlatılıyor...","Hazır!"],nl:["Bronnen laden...","Lettertypen voorbereiden...","Thema's configureren...","Systeem starten...","Klaar!"],pl:["Ładowanie zasobów...","Przygotowywanie czcionek...","Konfigurowanie motywów...","Uruchamianie systemu...","Gotowe!"],sv:["Laddar resurser...","Förbereder typsnitt...","Konfigurerar teman...","Startar systemet...","Redo!"],vi:["Đang tải tài nguyên...","Đang chuẩn bị phông chữ...","Đang cấu hình chủ đề...","Đang khởi động hệ thống...","Sẵn sàng!"],th:["กำลังโหลดทรัพยากร...","กำลังเตรียมแบบอักษร...","กำลังกำหนดค่าธีม...","กำลังเริ่มระบบ...","พร้อม!"],el:["Φόρτωση πόρων...","Προετοιμασία γραμματοσειρών...","Διαμόρφωση θεμάτων...","Εκκίνηση συστήματος...","Έτοιμο!"],uk:["Завантаження ресурсів...","Підготовка шрифтів...","Налаштування тем...","Запуск системи...","Готово!"]},r=s[currentLang]||s.en,i=setInterval(()=>{if(l+=10*Math.random(),l>90&&(l=90),n.style.setProperty("--progress",`${l}%`),a&&(a.textContent=`${Math.round(l)}%`),o){const e=Math.floor(l/100*(r.length-1));o.textContent=r[e]||r[0]}},100);Promise.all([document.fonts.ready,e,new Promise(e=>{"complete"===document.readyState?e():window.addEventListener("load",e)})]).catch(e=>console.error("Loading error:",e)).finally(()=>{clearInterval(i),n.style.setProperty("--progress","100%"),a&&(a.textContent="100%"),o&&(o.textContent=r[r.length-1]),setTimeout(()=>{t.classList.add("hidden"),setTimeout(()=>t.remove(),500)},500)})}}),document.addEventListener("keydown",e=>{const t=document.querySelector(".modal.open");t&&"Escape"===e.key&&t.classList.remove("open")});
